---
phase: 05-packaging-distribution
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/gitsneak.1.md
  - src/cli/index.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "User sees well-formatted --help with examples and environment info"
    - "Developer can generate man page from markdown source"
    - "Man page source exists in docs/gitsneak.1.md"
  artifacts:
    - path: "docs/gitsneak.1.md"
      provides: "Man page source in markdown"
      contains: "gitsneak(1)"
    - path: "src/cli/index.ts"
      provides: "Enhanced help output"
      contains: "addHelpText"
    - path: "package.json"
      provides: "marked-man devDependency"
      contains: "marked-man"
  key_links:
    - from: "docs/gitsneak.1.md"
      to: "man/gitsneak.1"
      via: "marked-man conversion"
      pattern: "marked-man"
---

<objective>
Enhanced --help output with examples and man page generation from markdown.

Purpose: Professional CLI experience with helpful --help and installable man page. Users get examples in terminal; developers get standard Unix documentation.

Output: Enhanced CLI help text, man page markdown source, marked-man integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-packaging-distribution/05-RESEARCH.md
@src/cli/index.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance --help output with examples and environment info</name>
  <files>src/cli/index.ts</files>
  <action>
Add `addHelpText('after', ...)` to the Commander program to display additional help sections after the auto-generated options.

After the existing `.option()` chain and before `.action()`, add:

```typescript
.addHelpText('after', `
Examples:
  $ gitsneak https://github.com/facebook/react
      Analyze contributors to React

  $ gitsneak -v --since 6m https://github.com/org/repo
      Verbose analysis of last 6 months

  $ gitsneak --html report.html https://github.com/org/repo1 https://github.com/org/repo2
      Generate HTML report for multiple repos

Date formats for --since:
  ISO date:    2025-01-01
  Relative:    12m (months), 1y (year), 2w (weeks), 30d (days)

Environment:
  NO_COLOR     Disable colored output

Documentation:
  man gitsneak
  https://github.com/jesseops/gitsneak
`)
```

This provides context that --help alone doesn't convey: real usage examples, date format details, and where to find more info.
  </action>
  <verify>Run `./dist/index.js --help` after rebuild. Should show options followed by Examples, Date formats, Environment, and Documentation sections.</verify>
  <done>--help displays enhanced output with examples and environment variables</done>
</task>

<task type="auto">
  <name>Task 2: Create man page markdown source and add marked-man</name>
  <files>docs/gitsneak.1.md, package.json</files>
  <action>
1. Install marked-man as devDependency:
   `npm install --save-dev marked-man`

2. Create `docs/gitsneak.1.md` with man page content following marked-man format (https://github.com/kapouer/marked-man):

```markdown
# gitsneak(1) -- analyze organizational involvement in GitHub repositories

## SYNOPSIS

`gitsneak` [options] <urls...>

## DESCRIPTION

gitsneak analyzes GitHub repositories to identify organizational involvement
by examining commits, pull requests, issues, and contributor profiles. It
produces ranked reports showing which companies have the most investment in
a project.

## OPTIONS

  * `-v`, `--verbose`:
    Show detailed output including URLs fetched and timing information.

  * `-q`, `--quiet`:
    Suppress progress indicators, show only final output.

  * `--delay` <ms>:
    Delay between requests in milliseconds. Default: 1500

  * `--since` <date>:
    Filter to activity after date. Accepts ISO dates (2025-01-01) or
    relative formats (12m, 6mo, 1y, 2w, 30d). Default: 12m

  * `--no-cache`:
    Bypass local cache and fetch fresh data from GitHub.

  * `--fail-fast`:
    Stop on first error instead of continuing with remaining repositories.

  * `--html` [path]:
    Generate HTML report. If path provided, writes to file; otherwise
    opens in default browser.

## EXAMPLES

Analyze a single repository:

    gitsneak https://github.com/facebook/react

Analyze multiple repositories with verbose output:

    gitsneak -v https://github.com/org/repo1 https://github.com/org/repo2

Generate HTML report for last 6 months:

    gitsneak --html report.html --since 6m https://github.com/org/repo

## EXIT STATUS

  * `0`: Success
  * `1`: Error (invalid URL, network failure, etc.)
  * `130`: Interrupted (Ctrl+C)

## FILES

  * `~/.local/share/gitsneak/cache.db`:
    SQLite cache for user profiles (XDG-compliant path on Linux).

## ENVIRONMENT

  * `NO_COLOR`:
    Disable colored output.

## SEE ALSO

GitHub repository: https://github.com/jesseops/gitsneak

## AUTHOR

Jesse Robertson
```

3. Add man page build script to package.json:
```json
"build:man": "mkdir -p man && npx marked-man docs/gitsneak.1.md --section 1 --name gitsneak --version $(node -p \"require('./package.json').version\") > man/gitsneak.1"
```

4. Add `man` directory to package.json files array for npm publishing:
```json
"files": ["dist", "man"]
```
  </action>
  <verify>Run `npm run build:man`. Verify man/gitsneak.1 is created with roff format. Run `man ./man/gitsneak.1` to preview.</verify>
  <done>docs/gitsneak.1.md exists, marked-man installed, npm run build:man generates man/gitsneak.1</done>
</task>

<task type="auto">
  <name>Task 3: Update prepublishOnly and verify man page</name>
  <files>package.json</files>
  <action>
Add prepublishOnly script to ensure man page is built before npm publish:

```json
"prepublishOnly": "npm run build && npm run build:man"
```

Test the full flow:
1. `npm run build:man` generates man/gitsneak.1
2. `man ./man/gitsneak.1` displays formatted man page
3. `npm pack --dry-run` shows man/ included in tarball

Also verify the justfile `man` recipe works (if 05-01 completed):
`just man` should produce same output.
  </action>
  <verify>`npm run build:man` succeeds. `man ./man/gitsneak.1` shows formatted page. `npm pack --dry-run` shows man/gitsneak.1 in package.</verify>
  <done>Man page generation integrated into build pipeline, prepublishOnly ensures it's included</done>
</task>

</tasks>

<verification>
1. `./dist/index.js --help` shows Examples, Date formats, Environment, Documentation sections
2. `npm run build:man` generates man/gitsneak.1 without errors
3. `man ./man/gitsneak.1` displays properly formatted man page
4. `npm pack --dry-run` includes man/gitsneak.1 in package
</verification>

<success_criteria>
- DIST-02 satisfied: Man page accessible (locally via `man ./man/gitsneak.1`)
- DIST-03 satisfied: Well-structured --help with sections, examples, defaults
- Man page source maintainable in markdown
- Build pipeline includes man page generation
</success_criteria>

<output>
After completion, create `.planning/phases/05-packaging-distribution/05-02-SUMMARY.md`
</output>
