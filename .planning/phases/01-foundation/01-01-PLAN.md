---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - tsup.config.ts
  - src/cli/index.ts
  - src/cli/options.ts
  - src/types/index.ts
  - src/output/logger.ts
  - src/output/progress.ts
autonomous: true

must_haves:
  truths:
    - "User can run `gitsneak <url>` and see usage/help"
    - "User can pass `-v`, `-q`, `--delay`, `--no-cache`, `--fail-fast` flags"
    - "Invalid URLs produce red error messages with suggestions"
    - "Valid URLs are parsed and ready for processing"
  artifacts:
    - path: "package.json"
      provides: "Project configuration with all dependencies"
      contains: "commander"
    - path: "src/cli/index.ts"
      provides: "CLI entry point with Commander.js"
      exports: ["main"]
    - path: "src/types/index.ts"
      provides: "Shared TypeScript types"
      exports: ["GitSneakOptions", "RepoInfo"]
    - path: "src/output/logger.ts"
      provides: "Colored logging utilities"
      exports: ["logError", "logWarning", "logSuccess", "logVerbose"]
  key_links:
    - from: "src/cli/index.ts"
      to: "src/cli/options.ts"
      via: "imports option definitions"
      pattern: "from.*options"
    - from: "src/cli/index.ts"
      to: "src/output/logger.ts"
      via: "imports logging functions"
      pattern: "from.*logger"
---

<objective>
Set up the GitSneak project structure and create a working CLI skeleton that accepts GitHub repository URLs with all command-line flags.

Purpose: Establish the foundation that all other plans build upon - project configuration, TypeScript setup, CLI argument parsing, and logging infrastructure.

Output: A runnable `gitsneak` CLI that validates URLs and displays help, errors, and progress placeholders.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Node.js project with TypeScript</name>
  <files>package.json, tsconfig.json, tsup.config.ts, .gitignore</files>
  <action>
Initialize the project and install all dependencies:

1. Run `npm init -y` to create package.json
2. Update package.json:
   - name: "gitsneak"
   - version: "1.0.0"
   - description: "Analyze organizational involvement in GitHub repositories"
   - type: "module"
   - main: "dist/cli/index.js"
   - bin: { "gitsneak": "dist/cli/index.js" }
   - scripts: { "build": "tsup", "dev": "tsup --watch" }

3. Install production dependencies:
   `npm install commander picocolors cli-progress cheerio better-sqlite3 p-retry env-paths`

4. Install dev dependencies:
   `npm install -D typescript tsup @types/node @types/better-sqlite3 @types/cli-progress`

5. Create tsconfig.json:
   - target: "ES2022"
   - module: "ESNext"
   - moduleResolution: "bundler"
   - strict: true
   - outDir: "dist"
   - rootDir: "src"
   - declaration: true

6. Create tsup.config.ts:
   - entry: ["src/cli/index.ts"]
   - format: ["esm"]
   - dts: true
   - clean: true
   - shims: true (for __dirname in ESM)
   - banner: { js: "#!/usr/bin/env node" }

7. Create .gitignore with: node_modules/, dist/, *.db, .DS_Store
  </action>
  <verify>
`npm run build` completes without errors
`ls dist/` shows cli/index.js exists
  </verify>
  <done>Project builds successfully with TypeScript and all dependencies installed</done>
</task>

<task type="auto">
  <name>Task 2: Create shared types and logging utilities</name>
  <files>src/types/index.ts, src/output/logger.ts, src/output/progress.ts</files>
  <action>
Create the shared infrastructure used by all modules:

1. Create src/types/index.ts with:
   ```typescript
   export interface GitSneakOptions {
     verbose: boolean;
     quiet: boolean;
     delay: number;      // milliseconds between requests
     cache: boolean;     // true by default, --no-cache sets false
     failFast: boolean;  // false by default, --fail-fast sets true
   }

   export interface RepoInfo {
     owner: string;
     repo: string;
     url: string;
   }

   export interface CacheStats {
     hits: number;
     misses: number;
   }

   export interface FetchResult {
     html: string;
     fromCache: boolean;
   }
   ```

2. Create src/output/logger.ts with picocolors:
   - `logError(message: string, suggestion?: string)` - red "Error:" prefix, yellow suggestion
   - `logWarning(message: string)` - yellow "Warning:" prefix
   - `logSuccess(message: string)` - green text
   - `logVerbose(message: string, options: GitSneakOptions)` - dim text, only if verbose=true and quiet=false
   - `logInfo(message: string, options: GitSneakOptions)` - normal text, only if quiet=false

3. Create src/output/progress.ts with cli-progress:
   - `createProgressBar(total: number, repoName: string)` - returns SingleBar
   - `createMultiProgress()` - returns MultiBar for multiple repos
   - Format: `{repo} [{bar}] {percentage}% | {value}/{total} | {status}`
   - Use picocolors.cyan for repo name
   - Handle quiet mode (return no-op progress bar)
  </action>
  <verify>
`npm run build` succeeds
`ls dist/types/` shows index.js and index.d.ts
`ls dist/output/` shows logger.js and progress.js
  </verify>
  <done>Types exported, logger functions handle all color cases, progress bar factory ready</done>
</task>

<task type="auto">
  <name>Task 3: Build CLI entry point with Commander.js</name>
  <files>src/cli/index.ts, src/cli/options.ts</files>
  <action>
Create the main CLI entry point with all flags per user decisions:

1. Create src/cli/options.ts:
   - Define parseDelay function to convert string to number with validation
   - Define parseGitHubUrl function to validate and extract owner/repo
     - Must be full URL: https://github.com/owner/repo
     - Return { owner, repo, url } or throw with helpful message
     - Reject shorthand like "owner/repo" with suggestion to use full URL

2. Create src/cli/index.ts:
   ```typescript
   import { Command } from 'commander';
   import pc from 'picocolors';
   import { parseGitHubUrl, parseDelay } from './options.js';
   import { logError, logWarning, logSuccess, logInfo } from '../output/logger.js';
   import type { GitSneakOptions, RepoInfo } from '../types/index.js';

   const program = new Command();

   program
     .name('gitsneak')
     .description('Analyze organizational involvement in GitHub repositories')
     .version('1.0.0')
     .argument('<urls...>', 'GitHub repository URLs to analyze')
     .option('-v, --verbose', 'show detailed output (URLs fetched, timing)', false)
     .option('-q, --quiet', 'suppress progress, show only final output', false)
     .option('--delay <ms>', 'delay between requests in milliseconds', parseDelay, '1500')
     .option('--no-cache', 'bypass cache and fetch fresh data')
     .option('--fail-fast', 'stop on first error instead of continuing', false)
     .action(async (urls: string[], opts) => {
       const options: GitSneakOptions = {
         verbose: opts.verbose,
         quiet: opts.quiet,
         delay: typeof opts.delay === 'string' ? parseInt(opts.delay) : opts.delay,
         cache: opts.cache,
         failFast: opts.failFast,
       };

       // Validate mutual exclusivity
       if (options.verbose && options.quiet) {
         logError('Cannot use --verbose and --quiet together');
         process.exitCode = 1;
         return;
       }

       // Parse and validate all URLs first
       const repos: RepoInfo[] = [];
       for (const url of urls) {
         try {
           repos.push(parseGitHubUrl(url));
         } catch (err) {
           logError(`Invalid GitHub URL: ${url}`, 'Use full URLs like https://github.com/owner/repo');
           if (options.failFast) {
             process.exitCode = 1;
             return;
           }
         }
       }

       if (repos.length === 0) {
         logError('No valid repository URLs provided');
         process.exitCode = 1;
         return;
       }

       // Log what we're about to do
       logInfo(`Analyzing ${repos.length} repositor${repos.length === 1 ? 'y' : 'ies'}...`, options);
       for (const repo of repos) {
         logVerbose(`  - ${repo.owner}/${repo.repo}`, options);
       }

       // Placeholder for actual processing (Phase 2+)
       logSuccess('URL validation complete. Processing will be implemented in future phases.');
     });

   export function main(): void {
     program.parse();
   }

   main();
   ```

3. Ensure the shebang is added by tsup (configured in Task 1)
  </action>
  <verify>
`npm run build` succeeds
`node dist/cli/index.js --help` shows all options
`node dist/cli/index.js https://github.com/facebook/react` outputs "Analyzing 1 repository..."
`node dist/cli/index.js invalid-url` shows red error with suggestion
`node dist/cli/index.js -v -q https://github.com/x/y` shows mutual exclusivity error
  </verify>
  <done>
CLI accepts URLs, validates them, shows help, handles all flags, displays colored errors with suggestions
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build succeeds: `npm run build` exits 0
2. Help works: `node dist/cli/index.js --help` shows usage with all flags
3. URL validation: Invalid URLs show red error with yellow suggestion
4. Flag parsing: All flags (-v, -q, --delay, --no-cache, --fail-fast) are recognized
5. Multiple repos: `node dist/cli/index.js url1 url2` shows "Analyzing 2 repositories"
6. Verbose mode: `-v` shows extra detail (parsed repos)
7. Quiet mode: `-q` suppresses info messages
8. Mutual exclusivity: `-v -q` together produces error
</verification>

<success_criteria>
- User can run `gitsneak https://github.com/owner/repo` and see it accepted
- User can run `gitsneak --help` and see all documented flags
- Invalid URLs produce actionable red error messages
- Project structure follows research recommendations (src/cli, src/types, src/output)
- TypeScript builds without errors
- All dependencies from research are installed
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` using the summary template.
</output>
